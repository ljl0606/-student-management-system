<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学生成绩管理系统</title>
    <link rel="icon" href="../favicon.ico">
    <link rel="stylesheet" type="text/css" href="../static/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="../static/css/main.css"/>

</head>

<body>
<div class="container">
    <div class="header">
        <span class="left">选 课 信 息 录 入</span>
        <span class="right">你 好，{{user_info}}管 理 员!</span>
        <span class="right_right"><a href="/">退出登陆</a></span>
    </div>
    <div class="leftside">
        <ul>
            <li><a href="/student">学生信息录入</a></li>
            <li><a href ="/updata_student">学生信息修改</a></li>
            <li><a href="/teacher_class">老师开设课程查看</a></li>
            <li class="first"><a href="#">选课信息录入</a></li>
            <li><a href="/grade">成绩信息录入</a></li>
            <li><a href="/grade_infos">学生成绩查看</a></li>
            <li><a href="/graduation">毕业去向</a></li>
            <li><a href="/adminstator">系统管理员变动</a></li>
            <li><a href="/classes">班级管理</a></li>

        </ul>

    </div>
    <div class="container-fluid">
        <h1 class="sub-header">学 生 选 课 信 息 录 入 系 统</h1>
        &nbsp;&nbsp;
        <hr>
        <div class="row">
            <div class="col-md-12">
                <form action="" method="get" class="form-inline">
                    <div class="form-group">
                        <label for="student_id">学号:</label>
                        <input type="text" class="form-control" id="student_id" name="student_id" placeholder="请输入学号" value="{{student_id}}">
                    </div>
                    <div class="form-group">
                        <label for="teacher_id">教师:</label>
                        <select class="form-control" id="teacher_id" name="teacher_id" onchange="updateCourses()">
                            <option value="">请选择教师</option>
                            {% for teacher in teachers %}
                            <option value="{{ teacher[0] }}" {% if teacher[0] == selected_teacher %}selected{% endif %}>{{ teacher[0] }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="selected_course">课程:</label>
                        <select class="form-control" id="selected_course" name="selected_course">
                            <option value="">请选择课程</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">搜索</button>
                </form>
            </div>
        </div>
        <br>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>学号</th>
                        <th>学生姓名</th>
                        <th>学生班级</th>
                        <th>所选课程名称1</th>
                        <th>所选课程名称2</th>
                        <th>所选课程名称3</th>
                    </tr>
                </thead>
                <tbody>
                    {% for result in results %}
                    <tr>
                        <td>{{result[0]}}</td>
                        <td>{{result[4]}}</td>
                        <td>{{result[5]}}</td>
                        <td>{{result[1]}}</td>
                        <td>{{result[2]}}</td>
                        <td>{{result[3]}}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <!-- 分页 -->
        <div class="row">
            <div class="col-md-12">
                <div class="pagination-container">
                    <nav aria-label="Page navigation">
                        <ul class="pagination">
                            {% if page > 1 %}
                            <li>
                                <a href="{{ url_for('teacher', page=page-1, student_id=student_id, selected_course=selected_course, teacher_id=selected_teacher) }}" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            {% endif %}
                            {% for i in range(1, total_pages+1) %}
                            <li {% if page == i %}class="active"{% endif %}>
                                {% if page == i %}
                                <span>{{i}}</span>
                                {% else %}
                                <a href="{{ url_for('teacher', page=i, student_id=student_id, selected_course=selected_course, teacher_id=selected_teacher) }}">{{i}}</a>
                                {% endif %}
                            </li>
                            {% endfor %}
                            {% if page < total_pages %}
                            <li>
                                <a href="{{ url_for('teacher', page=page+1, student_id=student_id, selected_course=selected_course, teacher_id=selected_teacher) }}" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                    <div class="pagination-info">
                        <span>共 {{total}} 条记录</span>
                        <span>跳转到</span>
                        <input type="number" id="jumpPage" min="1" max="{{total_pages}}" value="{{page}}">
                        <button onclick="jumpToPage()">确定</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    // 教师课程映射
    var teacherCourseMap = {{ teacher_course_map | tojson }};
    
    // 页面加载完成后初始化课程下拉框
    window.onload = function() {
        // 先更新课程下拉框
        updateCourses();
        
        // 预选中课程
        var courseSelect = document.getElementById('selected_course');
        var selectedCourse = '{{ selected_course }}';
        
        if (selectedCourse && courseSelect.options.length > 0) {
            for (var i = 0; i < courseSelect.options.length; i++) {
                if (courseSelect.options[i].value === selectedCourse) {
                    courseSelect.selectedIndex = i;
                    break;
                }
            }
        }
    };
    
    // 更新课程下拉框
    function updateCourses() {
        var teacherSelect = document.getElementById('teacher_id');
        var courseSelect = document.getElementById('selected_course');
        var selectedTeacher = teacherSelect.value;
        
        // 清空课程下拉框
        courseSelect.innerHTML = '<option value="">请选择课程</option>';
        
        // 如果选择了教师，则添加对应的课程
        if (selectedTeacher && teacherCourseMap[selectedTeacher]) {
            var courses = teacherCourseMap[selectedTeacher];
            for (var i = 0; i < courses.length; i++) {
                if (courses[i]) {
                    var option = document.createElement('option');
                    option.value = courses[i];
                    option.textContent = courses[i];
                    courseSelect.appendChild(option);
                }
            }
        }
    }
    
    // 分页跳转
    function jumpToPage() {
        var page = document.getElementById('jumpPage').value;
        var student_id = '{{student_id}}';
        var selected_course = '{{selected_course}}';
        var selected_teacher = '{{selected_teacher}}';
        var url = '/teacher?page=' + page;
        if (student_id) {
            url += '&student_id=' + encodeURIComponent(student_id);
        }
        if (selected_course) {
            url += '&selected_course=' + encodeURIComponent(selected_course);
        }
        if (selected_teacher) {
            url += '&teacher_id=' + encodeURIComponent(selected_teacher);
        }
        window.location.href = url;
    }
</script>
</body>

</html>