<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学生成绩管理系统</title>
    <link rel="icon" href="../favicon.ico">
    <link rel="stylesheet" type="text/css" href="../static/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="../static/css/main.css"/>
    <style>
    #addStudentModal {
        z-index: 9999;
    }
    .modal-dialog {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: calc(100vh - 60px);
    }
    .modal-body .form-group {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }
    .modal-body .form-group label {
        width: 80px;
        margin-right: 15px;
        text-align: right;
    }
    .modal-body .form-group .form-control {
        flex: 1;
    }
    .modal-header {
        padding: 10px 15px;
    }
    .modal-footer {
        padding: 10px 15px;
        margin-top: 0;
    }
    </style>
</head>


<body>
<div class="container">
    <div class="header">
        <span class="left">学 生 信 息 录 入</span>
        <span class="right">你 好，{{user_info}}管 理 员!</span>
        <span class="right_right"><a href="/">退出登陆</a></span>
    </div>
    <div class="leftside">
        <ul>
            <li class="first"><a href="/student">学生信息录入</a></li>
            <li><a href="/teacher_class">老师开设课程查看</a></li>
            <li><a href="/teacher">选课信息录入</a></li>
            <li><a href="/grade">成绩信息录入</a></li>
            <li><a href="/grade_infos">学生成绩查询</a></li>
            <li><a href="/graduation">毕业去向</a></li>
            <li><a href="/adminstator">系统管理员变动</a></li>
            <li><a href="/classes">班级管理</a></li>
        </ul>
    </div>
    
    <div class="container-fluid">
        <h1 class="sub-header">学 生 信 息 录 入 系 统</h1>&nbsp;&nbsp;
        <hr>
        <div class="row">
            <div class="col-md-12">
                <form action="" method="get" class="form-inline">
                    <div class="form-group">
                        <label for="student_id">学号:</label>
                        <input type="text" class="form-control" id="student_id" name="student_id" placeholder="请输入学号" value="{{student_id}}">
                    </div>
                    <div class="form-group">
                        <label for="student_class">班级:</label>
                        <select class="form-control" id="student_class" name="student_class">
                            <option value="">请选择班级</option>
                            {% for cls in classes %}
                            <option value="{{cls[1]}}" {% if student_class == cls[1] %}selected{% endif %}>{{cls[1]}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="student_name">姓名:</label>
                        <input type="text" class="form-control" id="student_name" name="student_name" placeholder="请输入姓名" value="{{student_name}}">
                    </div>
                    <div class="form-group">
                        <label for="student_sex">性别:</label>
                        <select class="form-control" id="student_sex" name="student_sex">
                            <option value="">请选择性别</option>
                            <option value="男" {% if student_sex == '男' %}selected{% endif %}>男</option>
                            <option value="女" {% if student_sex == '女' %}selected{% endif %}>女</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">搜索</button>
                    <button type="button" class="btn btn-success" onclick="showModal()">新增</button>
                </form>
                {% if error %}
                <div class="alert alert-danger" role="alert">{{error}}</div>
                {% endif %}
                <div>{{search_result}}</div>
            </div>
    </div>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>学号</th>
                    <th>班级</th>
                    <th>姓名</th>
                    <th>性别</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for result in results %}
                <tr>
                    <td>{{result[0]}}</td>
                    <td>{{result[1]}}</td>
                    <td>{{result[2]}}</td>
                    <td>{{result[3]}}</td>
                    <td>
                        <a href="/edit_student/{{result[0]}}" class="btn btn-sm btn-primary">编辑</a>
                        <a href="/delete_student/{{result[0]}}" class="btn btn-sm btn-danger">删除</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- 分页 -->
    <div class="row">
        <div class="col-md-12">
            <div class="pagination-container">
                <nav aria-label="Page navigation">
                    <ul class="pagination">
                        {% if page > 1 %}
                        <li>
                            <a href="{{ url_for('student', page=page-1, student_id=student_id, student_class=student_class, student_name=student_name, student_sex=student_sex) }}" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        {% endif %}
                        
                        {% for i in range(1, total_pages+1) %}
                        <li {% if page == i %}class="active"{% endif %}>
                            {% if page == i %}
                            <span>{{i}}</span>
                            {% else %}
                            <a href="{{ url_for('student', page=i, student_id=student_id, student_class=student_class, student_name=student_name, student_sex=student_sex) }}">{{i}}</a>
                            {% endif %}
                        </li>
                        {% endfor %}
                        
                        {% if page < total_pages %}
                        <li>
                            <a href="{{ url_for('student', page=page+1, student_id=student_id, student_class=student_class, student_name=student_name, student_sex=student_sex) }}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                <div class="pagination-info">
                    <span>共 {{total}} 条记录</span>
                    <span>跳转到</span>
                    <input type="number" id="jumpPage" min="1" max="{{total_pages}}" value="{{page}}">
                    <button onclick="jumpToPage()">确定</button>
                </div>
            </div>
        </div>
    </div>
       
    </div>
</div>

<!-- 新增学生模态框 -->
<div class="modal" id="addStudentModal" tabindex="-1" role="dialog" aria-labelledby="addStudentModalLabel" style="display: none;">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" onclick="hideModal()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="addStudentModalLabel">新增学生信息</h4>
            </div>
            <div class="modal-body">
                <form action="/add_student" method="post">
                    <div class="form-group">
                        <label for="new_student_id">学号:</label>
                        <input type="text" class="form-control" id="new_student_id" name="student_id" placeholder="请输入学号" required>
                    </div>
                    <div class="form-group">
                        <label for="new_student_class">班级:</label>
                        <select class="form-control" id="new_student_class" name="student_class" required>
                            <option value="">请选择班级</option>
                            {% for cls in classes %}
                            <option value="{{cls[1]}}">{{cls[1]}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="new_student_name">姓名:</label>
                        <input type="text" class="form-control" id="new_student_name" name="student_name" placeholder="请输入姓名" required>
                    </div>
                    <div class="form-group">
                        <label for="new_student_sex">性别:</label>
                        <select class="form-control" id="new_student_sex" name="student_sex" required>
                            <option value="">请选择性别</option>
                            <option value="男">男</option>
                            <option value="女">女</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" onclick="hideModal()">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="../static/js/jquery-3.3.1.min.js"></script>
<script src="../static/js/bootstrap.min.js"></script>
 <script>
    // 获取模态框
    var modal = document.getElementById('addStudentModal');
    
    // 显示模态框
    function showModal() {
        modal.style.display = 'block';
    }
    
    // 隐藏模态框
    function hideModal() {
        modal.style.display = 'none';
    }
    
    // 点击模态框外部区域也可以关闭模态框
    window.onclick = function(event) {
        if (event.target == modal) {
            hideModal();
        }
    }
    
    function jumpToPage() {
        var page = document.getElementById('jumpPage').value;
        var totalPages = {{total_pages}};
        
        if (page < 1 || page > totalPages) {
            alert('请输入有效页码');
            return;
        }
        
        // 构建URL
        var url = '{{ url_for('student', page=1, student_id=student_id, student_class=student_class, student_name=student_name, student_sex=student_sex) }}';
        // 替换页码
        url = url.replace('page=1', 'page=' + page);
        
        // 跳转到指定页
        window.location.href = url;
    }
</script>



</body>
</html>