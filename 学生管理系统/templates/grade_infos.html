<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>学生成绩管理系统</title>
     <link rel="icon" href="../favicon.ico">
     <link rel="stylesheet" type="text/css" href="../static/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="../static/css/main.css"/>

</head>

<body>
<div class="container">
    <div class="header">
        <span class="left">学 生 成 绩 查 询</span>
        <span class="right">你 好，{{user_info}}老 师!</span>
        <span class="right_right"><a href="/">退出登陆</a></span>
    </div>
    <div class="leftside">
        <ul>
            <li><a href="/student">学生信息录入</a></li>
            <li><a href ="/updata_student">学生信息修改</a></li>
            <li><a href="/teacher_class">老师开设课程查看</a></li>
            <li><a href="/teacher">选课信息录入</a></li>
            <li><a href="/grade">成绩信息录入</a></li>
            <li class="first"><a href="#">学生成绩查询</a></li>
            <li><a href="/graduation">毕业去向</a></li>
            <li><a href="/adminstator">系统管理员变动</a></li>
            <li><a href="/classes">班级管理</a></li>
        </ul>
    </div>
    <div class="container-fluid">
        <h1 class="sub-header">学 生 成 绩 查 询 系 统</h1>&nbsp;&nbsp;
        <hr>
        <div class="row">
            <div class="col-md-12">
                <form action="" method="get" class="form-inline">
                    <div class="form-group">
                        <label for="student_selector">学号:</label>
                        <div style="position: relative;">
                            <input type="text" class="form-control" id="student_selector" placeholder="输入学号或姓名查找" value="{% for student in students %}{% if student[0] == student_id %}{{student[0]}} - {{student[1]}}{% endif %}{% endfor %}" onkeyup="filterStudentOptions()" autocomplete="off" style="color: #000; background-color: #fff;">
                            <input type="hidden" name="student_id" id="student_id_hidden" value="{{student_id}}">
                            <div id="student_options" style="position: absolute; top: 100%; left: 0; width: 100%; max-height: 200px; overflow-y: auto; display: none; background-color: #fff; border: 1px solid #ddd; border-radius: 0 0 4px 4px; z-index: 1000; margin-top: -1px;"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="course_id">课程:</label>
                        <input type="text" class="form-control" id="course_id" name="course_id" value="{{course_id}}" placeholder="请输入课程号">
                    </div>
                    <div class="form-group">
                        <label for="grade_range">成绩范围:</label>
                        <select name="grade_range" id="grade_range" class="form-control">
                            <option value="">请选择成绩范围</option>
                            <option value="<60" {% if grade_range == "<60" %}selected{% endif %}>&lt;60</option>
                            <option value="<80" {% if grade_range == "<80" %}selected{% endif %}>&lt;80 (60-79)</option>
                            <option value="<90" {% if grade_range == "<90" %}selected{% endif %}>&lt;90 (80-89)</option>
                            <option value=">=90" {% if grade_range == ">=90" %}selected{% endif %}>&gt;=90</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">搜索</button>
                    <a href="{{ url_for('grade_infos') }}" class="btn btn-default">重置</a>
                </form>
            </div>
        </div>
        <br>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>学生学号</th>
                        <th>学生姓名</th>
                        <th>学生班级</th>
                        <th>课程名称</th>
                        <th>成绩</th>
                    </tr>
                </thead>
                <tbody>
                    {% for result in results %}
                    <tr>
                        <td>{{result[0]}}</td>
                        <td>{{result[3]}}</td>
                        <td>{{result[4]}}</td>
                        <td>{{result[1]}}</td>
                        <td>{{result[2]}}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <!-- 分页 -->
        <div class="row">
            <div class="col-md-12">
                <div class="pagination-container">
                    <nav aria-label="Page navigation">
                        <ul class="pagination">
                            {% if page > 1 %}
                            <li>
                                <a href="{{ url_for('grade_infos', page=page-1, student_id=student_id, course_id=course_id, grade_range=grade_range) }}" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            {% endif %}
                            
                            {% for i in range(1, total_pages+1) %}
                            <li {% if page == i %}class="active"{% endif %}>
                                {% if page == i %}
                                <span>{{i}}</span>
                                {% else %}
                                <a href="{{ url_for('grade_infos', page=i, student_id=student_id, course_id=course_id, grade_range=grade_range) }}">{{i}}</a>
                                {% endif %}
                            </li>
                            {% endfor %}
                            
                            {% if page < total_pages %}
                            <li>
                                <a href="{{ url_for('grade_infos', page=page+1, student_id=student_id, course_id=course_id, grade_range=grade_range) }}" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                    <div class="pagination-info">
                        <span>共 {{total}} 条记录</span>
                        <span>跳转到</span>
                        <input type="number" id="jumpPage" min="1" max="{{total_pages}}" value="{{page}}">
                        <button onclick="jumpToPage()">确定</button>
                    </div>
                </div>
            </div>
        </div>
        <script>
            function jumpToPage() {
                var page = document.getElementById('jumpPage').value;
                var url = '{{ url_for('grade_infos', page=1, student_id=student_id, course_id=course_id, grade_range=grade_range) }}';
                url = url.replace('page=1', 'page=' + page);
                window.location.href = url;
            }
            
            // 学号搜索过滤功能
            function filterStudentOptions() {
                var input = document.getElementById('student_selector');
                var filter = input.value.toLowerCase();
                var optionsDiv = document.getElementById('student_options');
                
                // 清空之前的结果
                optionsDiv.innerHTML = '';
                
                // 学生数据
                var students = [
                    {% for student in students %}
                    {"id": "{{student[0]}}", "name": "{{student[1]}}"}{% if not loop.last %},{% endif %}
                    {% endfor %}
                ];
                
                // 如果输入为空，不显示结果
                if (filter === '') {
                    optionsDiv.style.display = 'none';
                    return;
                }
                
                // 过滤并显示匹配的选项
                var filteredStudents = students.filter(function(student) {
                    return student.id.toLowerCase().includes(filter) || student.name.toLowerCase().includes(filter);
                });
                
                // 创建选项
                filteredStudents.forEach(function(student) {
                    var a = document.createElement('a');
                    a.className = 'list-group-item';
                    a.textContent = student.id + ' - ' + student.name;
                    a.style.cursor = 'pointer';
                    a.style.color = '#000'; // 设置文本颜色
                    a.style.backgroundColor = '#fff'; // 设置背景颜色
                    a.onclick = function() {
                        // 设置输入框显示的文本
                        document.getElementById('student_selector').value = this.textContent;
                        // 设置隐藏字段的值
                        document.getElementById('student_id_hidden').value = student.id;
                        // 隐藏选项列表
                        document.getElementById('student_options').style.display = 'none';
                    };
                    optionsDiv.appendChild(a);
                });
                
                // 如果有匹配的结果，显示选项列表
                if (filteredStudents.length > 0) {
                    optionsDiv.style.display = 'block';
                } else {
                    optionsDiv.style.display = 'none';
                }
            }
            
            // 页面加载时初始化
            document.addEventListener('DOMContentLoaded', function() {
                // 为输入框添加事件监听
                var input = document.getElementById('student_selector');
                input.addEventListener('input', filterStudentOptions);
                
                // 点击页面其他地方关闭下拉菜单
                document.addEventListener('click', function(event) {
                    var optionsDiv = document.getElementById('student_options');
                    var input = document.getElementById('student_selector');
                    if (event.target !== input && !optionsDiv.contains(event.target)) {
                        optionsDiv.style.display = 'none';
                    }
                });
                
                // 表单提交前更新隐藏字段
                var form = document.querySelector('.form-inline');
                form.addEventListener('submit', function() {
                    // 如果用户没有选择下拉选项，而是手动输入的学号或姓名
                    // 我们需要提取学号或姓名并更新隐藏字段
                    var inputValue = document.getElementById('student_selector').value;
                    var hiddenField = document.getElementById('student_id_hidden');
                    
                    // 如果输入值包含学号和姓名（格式：学号 - 姓名）
                    if (inputValue.includes(' - ')) {
                        // 提取学号
                        hiddenField.value = inputValue.split(' - ')[0];
                    } else if (inputValue !== '') {
                        // 否则，直接将输入值作为学号搜索
                        hiddenField.value = inputValue;
                    }
                });
            });
        </script>

    </div>
</div>
</body>

</html>